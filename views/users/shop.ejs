<%- include('../partials/head.ejs') %>
<%- include('../partials/header.ejs') %>

  

  <div class="container-fluid w-100 bg-primary mt-5 ps-5 d-flex align-items-center" style="height: 10vh">
 
    <li class="breadcrumb-item" style="list-style: none;"><a href="/">Home</a></li>
    <li class="breadcrumb-item active" aria-current="page" style="list-style: none; max-width: 500px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
       My Account
    </li>

</div>

<div class="container">
  <div class="row">
    
    <div class="col-lg-3">
     
      <nav class="navbar navbar-light col-lg-9 mt-5">
        <a class="navbar-brand" href="#"><h3>Brand</h3></a>
       
      
          <ul class="navbar-nav mr-auto">
            <% brandData.forEach(brand => { %>
              <li class="nav-item">
                <div class="d-flex justify-content-between align-items-center">
                  <a href="#" class="nav-link" onclick="brandFilter(event, '<%= brand.brand_name %>')" ><%= brand.brand_name%></a>
                 
                </div>
              </li>
            <% }); %>
          </ul>

      </nav>

      <!-- Category Filter -->
      <nav class="navbar navbar-light col-lg-9 ">
        <a class="navbar-brand" href="#"><h3>Category</h3></a>
       
        
          <ul class="navbar-nav mr-auto">
            <% categoryData.forEach(category => { %>
              <li class="nav-item">
                <div class="d-flex justify-content-between align-items-center">
                  <a href="#" class="nav-link" onclick="categoryFilter(event, '<%= category.cat_name %>')" ><%= category.cat_name%></a>
                 
                </div>
              </li>
            <% }); %>
          </ul>
          <a href="/shop">
         <button class="btn btn-primary rounded rounded-3 mt-2 mb-5">Clear All Filter</button>

        </a>
      </nav>



    </div>

    <!-- Product Cards Section -->
    <div class="col-lg-9 mt-5">
      <div class="d-flex  align-items-end justify-content-end">
        <p>Sort by:</p>
        <select id="filter" name="filter" onchange="applyFilter()">
            <option value="">select</option>
            <option value="price-low-high">Low to High</option>
            <option value="price-high-low">High to Low</option>
            <option value="a-z">A-Z</option>
            <option value="z-a">Z-A</option>
          
            <option value="new-arrivals">New Arrivals</option>
        </select>
</div>

      <div class="row">
        <% productData.forEach(product => { %>
          <div class="col-lg-4 col-md-6 col-sm-12 mb-4">

            <!-- <div classf="col-sm-6  col-md-4 col-lg-3 ms-2 border border-1"> -->

              <div class="card">
                <a href="/product/<%= product._id %>">
                
                <img src="/public/uploads/<%= product.images[0] %>" class="card-img-top" alt="Product Image">
                <div class="card-body text-center">
                    <h5 class="product-title"><%=product.name %></h5>
                    <% if(product.offer &&product.offer.discountPercentage && product.offer.expirAt>Date.now()){%>
                    <div class="price">
                        <span>₹<%=product.price-(product.price*(product.offer.discountPercentage/100))%></span>
                        <span class="text-muted">₹<%=product.price%></span>
                        <span class="text-success">(<%=product.offer.discountPercentage%>%Off)</span>
                    </div>
                    <% } else{ %>
                    <div class="price">
                      <span>₹<%=product.price%></span>
                      
                  </div>
                  <% } %>
                    <div class="rating mt-2">
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <span class="reviews">(65)</span>
                    </div>
                </div>
           </a>
            </div>
         
          </div>
        <% }); %>
      </div>
      <div class="w-100 d-flex justify-content-center mt-3">
        <nav aria-label="Page navigation">
            <ul class="pagination">
                <!-- Previous button -->
                <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                    <a class="page-link"  href="/shop?page=<%= currentPage + 1 %>&filter=<%= filter?filter:'' %>&brand=<%= brand?brand:'' %>&category=<%= category? category:""  %>" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
    
                <!-- Page number buttons -->
                <% for (let i = 1; i <= totalPages; i++) { %> 
                    <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                        <a class="page-link"  href="/shop?page=<%= currentPage + 1 %>&filter=<%= filter?filter:'' %>&brand=<%= brand?brand:'' %>&category=<%= category? category:""  %>"><%= i %></a>
                    </li>
                <% } %>
    
                <!-- Next button -->
                <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                    <a class="page-link" href="/shop?page=<%= currentPage + 1 %>&filter=<%= filter?filter:'' %>&brand=<%= brand?brand:'' %>&category=<%= category? category:""  %>" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
    
    </div>
  </div>
</div>
<script>
   function applyFilter() {
        const filterValue=document.getElementById('filter').value;
        const url = new URL(window.location.href);
        url.searchParams.set('filter', filterValue);
        window.location.href = url;
    }

   
    function categoryFilter(event, category){
        event.preventDefault()
        const url = new URL(window.location.href);
        url.searchParams.set('category', category);
        window.location.href = url;
       
    }

    function brandFilter(event, brand){
        event.preventDefault()
        const url = new URL(window.location.href);
        url.searchParams.set('brand', brand);
        window.location.href = url;
        
    }
    
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

<%- include('../partials/footer.ejs') %>